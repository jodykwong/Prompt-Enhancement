# 提示词增强工具 - 使用指南

## 📋 功能说明

提示词增强工具的职责是：

✅ **应该做的事**：
- 接收用户输入的原始提示词
- 调用 DeepSeek API 进行增强
- 返回增强后的提示词
- 展示增强结果
- **【NEW】等待用户确认后执行增强版本**

❌ **不应该做的事**：
- 不自动执行增强后的提示词（必须等待用户确认）
- 不强制将增强版本作为执行指令
- 不忽视用户的选择

## 🚀 使用方式

### 🆕 方式 0: Claude Code 集成（最推荐）

在 Claude Code 中直接使用 `/pe` 命令：

```bash
/pe "您的提示词"
```

**工作流程**：
1. ✅ Claude 执行增强脚本
2. ✅ 显示原始和增强后的提示词
3. ✅ 询问您的选择（三个选项）：
   - **执行增强版本** - 立即按增强后的提示词执行任务
   - **仅复制** - 只复制结果，稍后再用
   - **取消** - 返回，不使用增强结果
4. ✅ 根据您的选择执行相应操作

**示例**：
```
/pe 修复登录页面的 bug

→ Claude 会：
  1. 等待 30-60 秒调用 API
  2. 显示增强后的提示词
  3. 询问: "请审查增强后的提示词"
  4. 您选择"执行增强版本"
  5. Claude 按增强后的指令修复 bug
```

**优势**：
- 🎯 最方便 - 不需要离开 Claude Code
- 👀 可见性 - 在执行前审查增强结果
- 🎮 交互性 - 完全由您控制是否执行

---

### 方式 1: 交互式使用

```bash
python interactive_enhance.py
```

**步骤**：
1. 运行脚本
2. 输入待增强的提示词
3. 等待 API 返回增强结果（约 30-40 秒）
4. 查看增强后的提示词
5. 复制增强后的提示词用于其他用途

### 方式 2: 命令行参数

```bash
python prompt_enhancer.py "待增强的提示词"
```

**示例**：
```bash
python prompt_enhancer.py "优化代码"
python prompt_enhancer.py "修复登录 bug"
python prompt_enhancer.py "添加用户认证功能"
```

### 方式 3: Python API

```python
from prompt_enhancer import PromptEnhancer

# 初始化增强器
enhancer = PromptEnhancer()

# 增强提示词
result = enhancer.enhance("优化代码")

# 查看结果
print(f"原始: {result['original']}")
print(f"增强: {result['enhanced']}")
print(f"耗时: {result['processing_time']:.2f} 秒")
```

## 📊 预期结果

### 输入示例
```
优化代码
```

### 输出示例
```
优化代码性能和质量。请按以下步骤进行：

1. 性能分析：
   - 使用性能分析工具识别瓶颈
   - 分析时间复杂度和空间复杂度
   - 识别热点代码路径

2. 优化策略：
   - 算法优化：选择更高效的算法
   - 代码优化：减少不必要的计算
   - 缓存优化：添加合理的缓存机制

3. 测试验证：
   - 运行现有测试确保功能不变
   - 进行性能基准测试
   - 验证边界条件和异常情况

验证标准：性能有明显提升，代码质量提高，所有测试通过。
```

## ⏱️ 处理时间

- **DeepSeek-V3.2-Speciale（思考模式）**: 30-40 秒
  - 这是正常的，因为模型进行深度思考和推理
  - 输出质量更高

- **演示模式**: < 1 秒
  - 使用预设示例，无需 API 调用

## 🎯 使用场景

### 场景 1: 改进模糊的任务描述

**原始提示词**：
```
修复 bug
```

**增强后**：
```
修复代码中的缺陷。请按以下步骤进行：

1. 问题定位：
   - 收集错误日志和堆栈跟踪信息
   - 复现问题，确定触发条件
   - 识别出现问题的具体代码位置

2. 原因分析：
   - 审查相关代码逻辑
   - 检查边界条件和异常情况处理
   - 分析是否存在逻辑错误

3. 实施修复：
   - 编写修复代码
   - 确保修复不引入新问题
   - 添加必要的错误处理

4. 测试验证：
   - 编写或更新单元测试
   - 验证修复后问题不再出现
   - 进行回归测试

验证标准：bug 完全修复，相关测试通过，无新增问题。
```

### 场景 2: 添加具体的执行步骤

**原始提示词**：
```
添加用户登录功能
```

**增强后**：
```
实现用户登录功能模块。请按以下步骤进行：

1. 需求分析：
   - 确定登录方式
   - 明确安全要求
   - 定义用户体验流程

2. 数据库设计：
   - 设计用户表结构
   - 设计会话/令牌表
   - 考虑索引优化

3. 后端实现：
   - 实现用户注册接口
   - 实现登录验证接口
   - 添加身份验证中间件

4. 前端实现：
   - 创建登录表单页面
   - 实现表单验证
   - 处理登录状态管理

5. 安全措施：
   - 防止 SQL 注入和 XSS 攻击
   - 实现登录失败次数限制
   - 使用 HTTPS 传输敏感信息

6. 测试：
   - 单元测试
   - 集成测试
   - 安全测试

验证标准：用户能够成功注册和登录，密码安全存储，会话管理正确。
```

## 💡 最佳实践

### 【NEW】使用 `/pe` 命令的建议

1. **审查增强结果后再执行**
   - 总是检查增强后的提示词
   - 确认增强内容符合您的需求
   - 在不确定时选择"仅复制"而非立即执行

2. **灵活选择执行方式**
   - **执行增强版本**: 当增强结果满意时使用，可节省时间
   - **仅复制**: 当需要进一步编辑时使用，或保存供后续使用
   - **取消**: 当增强结果不符合期望时使用

3. **充分利用确认机制**
   - 确认机制确保您始终掌控全局
   - 没有增强结果会被强制执行
   - 您随时可以修改或取消

---

### 其他使用建议

1. **输入清晰的原始提示词**
   - 提供足够的上下文
   - 说明任务的目标
   - 指出任何特殊要求

2. **理解不同的使用模式**
   - `/pe` 命令：在 Claude Code 中直接使用（推荐）
   - 交互式脚本：用于本地开发和测试
   - Python API：用于集成到自己的应用中

3. **监控处理时间**
   - 第一次调用可能需要 30-40 秒
   - 这是正常的，不是错误
   - 后续调用时间可能有所不同（缓存可能加速）

## 🔧 故障排查

### 问题 1: DEEPSEEK_API_KEY 未找到

**解决方案**：
```bash
# 检查 .env 文件
cat .env

# 确保包含有效的 API 密钥
# DEEPSEEK_API_KEY=sk-xxxxx
```

### 问题 2: API 调用超时

**解决方案**：
- 检查网络连接
- 确保能访问 api.deepseek.com
- 重试请求

### 问题 3: 处理时间过长

**解决方案**：
- 这是正常的（30-40 秒）
- DeepSeek 思考模式需要更多时间
- 输出质量更高

## 📚 相关文件

- `prompt_enhancer.py` - 核心增强器（需要 API 密钥）
- `interactive_enhance.py` - 交互式工具（推荐使用）
- `demo_enhancer.py` - 演示版本（无需 API 密钥）
- `demo_test.py` - 演示测试（展示预期效果）

## ✨ 总结

提示词增强工具的核心原则：

1. **接收用户输入** - 获取原始提示词
2. **调用 API 增强** - 使用 DeepSeek 进行增强
3. **返回结果** - 展示增强后的提示词
4. **由用户决定** - 用户决定如何使用增强结果

**记住**：增强工具只负责增强，不负责执行！

